<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cat Speed Typing Adventure</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="overlay">
    <h1>ğŸ± Cat Speed Typing Adventure</h1>
    <p class="instructions">
      Type the cat fact as fast as you can! The faster you type, the further the cat runs toward the goal ğŸ
    </p>

    <div class="controls">
      <label for="difficulty">Choose Difficulty:</label>
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium" selected>Medium</option>
        <option value="hard">Hard</option>
      </select>
      <button id="startBtn">Start Game</button>
      <button id="cancelBtn" disabled>Cancel</button>
    </div>

    <div class="game-area">
      <div class="track">
        <img src="images/running_cat.gif" class="cat" id="cat" alt="Running Cat">
        <div class="finish-line">ğŸ</div>
      </div>
    </div>

    <div class="typing-area">
      <p id="fact">Press "Start Game" to begin!</p>
      <textarea id="input" placeholder="Type here..." rows="3" disabled></textarea>
    </div>

    <div class="status">
      <p id="progress">Progress: 0%</p>
      <p id="timer">Time left: 0s</p>
      <p id="result"></p>
    </div>
  </div>

  <!-- Inline JavaScript -->
  <script>
    const factEl = document.getElementById("fact");
    const inputEl = document.getElementById("input");
    const startBtn = document.getElementById("startBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const resultEl = document.getElementById("result");
    const progressEl = document.getElementById("progress");
    const timerEl = document.getElementById("timer");
    const catEl = document.getElementById("cat");
    const difficultySelect = document.getElementById("difficulty");

    let currentFact = "";
    let progress = 0;
    let timeLeft = 30;
    let timer;

    async function fetchFact() {
      try {
        const res = await fetch("/api/fact"); // Express API
        const data = await res.json();
        return data.fact;
      } catch (error) {
        return "Cats are amazing creatures!";
      }
    }

    function setDifficulty() {
      const level = difficultySelect.value;
      if(level === "easy") timeLeft = 45;
      else if(level === "medium") timeLeft = 30;
      else if(level === "hard") timeLeft = 20;
    }

    async function startGame() {
      setDifficulty();
      currentFact = await fetchFact();
      factEl.textContent = currentFact;
      inputEl.value = "";
      inputEl.focus();
      progress = 0;
      resultEl.textContent = "";
      progressEl.textContent = "Progress: 0%";
      timerEl.textContent = `Time left: ${timeLeft}s`;
      catEl.style.left = "0px";

      startBtn.disabled = true;
      cancelBtn.disabled = false;
      inputEl.disabled = false;

      if (timer) clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = `Time left: ${timeLeft}s`;
        if (timeLeft <= 0) endGame(false, "â³ Timeâ€™s up! The cat got caught!");
      }, 1000);
    }

    function moveCat() {
      const typed = inputEl.value;
      const correctPart = currentFact.substring(0, typed.length);

      if (typed === correctPart) {
        progress = Math.floor((typed.length / currentFact.length) * 100);
        progressEl.textContent = `Progress: ${progress}%`;

        const trackWidth = document.querySelector(".track").offsetWidth;
        const newLeft = (progress / 100) * (trackWidth - 140);
        catEl.style.left = `${newLeft}px`;

        if (progress === 100) endGame(true, "ğŸ‰ You finished in time! The cat reached the goal!");
      }
    }

    function endGame(won, message) {
      clearInterval(timer);
      resultEl.textContent = message;
      inputEl.disabled = true;
      startBtn.disabled = false;
      cancelBtn.disabled = true;
    }

    function cancelGame() {
      clearInterval(timer);
      resultEl.textContent = "âŒ Game canceled!";
      progress = 0;
      progressEl.textContent = "Progress: 0%";
      timerEl.textContent = `Time left: 0s`;
      catEl.style.left = "0px";
      inputEl.value = "";
      inputEl.disabled = true;
      startBtn.disabled = false;
      cancelBtn.disabled = true;
    }

    inputEl.addEventListener("input", moveCat);
    startBtn.addEventListener("click", startGame);
    cancelBtn.addEventListener("click", cancelGame);
  </script>
</body>
</html>
